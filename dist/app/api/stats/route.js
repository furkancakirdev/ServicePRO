"use strict";(()=>{var e={};e.id=2961,e.ids=[2961],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4542:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var a={};r.r(a),r.d(a,{GET:()=>o});var s=r(49303),i=r(88716),u=r(60670),n=r(87070),l=r(72331);async function o(){try{let[e,t,r,a,s,i,u,o]=await Promise.all([l._.service.count({where:{deletedAt:null}}),l._.service.count({where:{deletedAt:null,durum:"DEVAM_EDİYOR"}}),l._.service.count({where:{deletedAt:null,durum:"TAMAMLANDI"}}),l._.service.count({where:{deletedAt:null,tarih:{gte:new Date}}}),l._.tekne.count({where:{deletedAt:null,aktif:!0}}),l._.personel.count({where:{deletedAt:null,aktif:!0}}),l._.service.groupBy({by:["durum"],where:{deletedAt:null},_count:!0}),l._.service.groupBy({by:["isTuru"],where:{deletedAt:null},_count:!0})]),d=new Date;d.setDate(d.getDate()-7);let c=await l._.service.findMany({where:{deletedAt:null,createdAt:{gte:d}},select:{createdAt:!0}}),p=Array.from({length:7},(e,t)=>{let r=new Date;r.setDate(r.getDate()-(6-t));let a=r.toISOString().split("T")[0];return{tarih:a,sayı:c.filter(e=>e.createdAt.toISOString().split("T")[0]===a).length}}),m=await l._.auditLog.findMany({take:10,orderBy:{createdAt:"desc"},include:{user:{select:{id:!0,ad:!0,email:!0}}}});return n.NextResponse.json({toplamServis:e,aktifServisler:t,tamamlananServisler:r,bekleyenServisler:e-t-r,bugunServisler:a,teknelerSayisi:s,personelSayisi:i,durumDağılımı:u.map(e=>({durum:e.durum,sayı:e._count})),isTuruDağılımı:o.map(e=>({isTuru:e.isTuru,sayı:e._count})),gunlukTrend:p,sonAktiviteler:m.map(e=>({id:e.id,islem:e.islemTuru,entity:e.entityTipi,userId:e.userId,userAd:e.user?.ad||"Sistem",createdAt:e.createdAt}))})}catch(e){return console.error("GET /api/stats error:",e),n.NextResponse.json({error:"İstatistikler getirilemedi"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stats/route",pathname:"/api/stats",filename:"route",bundlePath:"app/api/stats/route"},resolvedPagePath:"C:\\Users\\furkan.cakir\\Desktop\\ServicePro\\ServicePro_Demo\\app\\api\\stats\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:m}=d,A="/api/stats/route";function h(){return(0,u.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},72331:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(53524);let s=global.prisma||new a.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972],()=>r(4542));module.exports=a})();