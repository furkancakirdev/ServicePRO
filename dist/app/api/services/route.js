"use strict";(()=>{var e={};e.id=84,e.ids=[84],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},23238:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v});var i={};t.r(i),t.d(i,{GET:()=>d,POST:()=>c});var s=t(49303),a=t(88716),n=t(60670),o=t(87070),u=t(72331),l=t(46569);async function d(e){try{let{searchParams:r}=new URL(e.url),t=parseInt(r.get("page")||"1"),i=parseInt(r.get("limit")||"50"),s=r.get("durum"),a=r.get("tekneId"),n=r.get("arama"),l=(t-1)*i,d={deletedAt:null};s&&(d.durum=s),a&&(d.tekneId=a),n&&(d.OR=[{servisAciklamasi:{contains:n,mode:"insensitive"}},{tekneAdi:{contains:n,mode:"insensitive"}},{adres:{contains:n,mode:"insensitive"}}]);let c=await u._.service.count({where:d}),p=await u._.service.findMany({where:d,include:{tekne:!0,ofisYetkili:{select:{id:!0,ad:!0,email:!0,role:!0}},personeller:{include:{personel:!0}},bekleyenParcalar:!0},orderBy:[{durum:"asc"},{tarih:"desc"},{createdAt:"desc"}],skip:l,take:i});return o.NextResponse.json({services:p,pagination:{page:t,limit:i,total:c,totalPages:Math.ceil(c/i)}})}catch(e){return console.error("GET /api/services error:",e),o.NextResponse.json({error:"Servisler getirilemedi"},{status:500})}}async function c(e){try{if(!(0,l.so)(e.headers.get("authorization")))return o.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),t=await u._.service.create({data:{tarih:r.tarih?new Date(r.tarih):null,saat:r.saat,isTuru:r.isTuru||"PAKET",tekneId:r.tekneId,tekneAdi:r.tekneAdi,adres:r.adres,yer:r.yer,servisAciklamasi:r.servisAciklamasi,irtibatKisi:r.irtibatKisi,telefon:r.telefon,durum:r.durum||"RANDEVU_VERILDI",ofisYetkiliId:r.ofisYetkiliId,taseronNotlari:r.taseronNotlari},include:{tekne:!0,ofisYetkili:{select:{id:!0,ad:!0,email:!0}}}});return await u._.auditLog.create({data:{userId:r.userId,userEmail:r.userEmail,islemTuru:"CREATE",entityTipi:"Service",entityId:t.id,detay:`Yeni servis oluşturuldu: ${t.tekneAdi}`}}),o.NextResponse.json(t,{status:201})}catch(e){return console.error("POST /api/services error:",e),o.NextResponse.json({error:"Servis oluşturulamadı"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/services/route",pathname:"/api/services",filename:"route",bundlePath:"app/api/services/route"},resolvedPagePath:"C:\\Users\\furkan.cakir\\Desktop\\ServicePro\\ServicePro_Demo\\app\\api\\services\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:k}=p,g="/api/services/route";function f(){return(0,n.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}},72331:(e,r,t)=>{t.d(r,{_:()=>s});var i=t(53524);let s=global.prisma||new i.PrismaClient({log:["error"]})},46569:(e,r,t)=>{t.d(r,{RA:()=>n,WX:()=>o,so:()=>u});var i=t(86890),s=t(41463);let a=new TextEncoder().encode(process.env.JWT_SECRET||"fallback-secret-change-in-production");async function n(e){return await new i.N({...e}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(a)}async function o(e){try{let{payload:r}=await (0,s._)(e,a);if("userId"in r&&"email"in r&&"role"in r)return r;return null}catch(e){return console.error("Token verification failed:",e),null}}function u(e){return e?.startsWith("Bearer ")?e.substring(7):null}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[9276,5972,1814],()=>t(23238));module.exports=i})();