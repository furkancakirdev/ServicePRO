"use strict";(()=>{var e={};e.id=9475,e.ids=[9475],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},15673:e=>{e.exports=require("node:events")},97742:e=>{e.exports=require("node:process")},47261:e=>{e.exports=require("node:util")},24829:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>q});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>x});var n=t(49303),o=t(88716),i=t(60670),a=t(87070),u=t(53560),p=t(46569);async function c(e){let r=e.headers.get("authorization"),t=(0,p.so)(r);return t?await (0,p.WX)(t)||a.NextResponse.json({error:"Unauthorized - Invalid token"},{status:401}):a.NextResponse.json({error:"Unauthorized - No token provided"},{status:401})}function l(e){return r=>{let t=r.headers.get("authorization"),s=(0,p.so)(t);if(!s)return a.NextResponse.json({error:"Unauthorized"},{status:401});let n=function(e){try{let r=e.split(".")[1];if(!r)return null;let t=r.replace(/-/g,"+").replace(/_/g,"/"),s=atob(t);return JSON.parse(s)}catch{return null}}(s);if(!n||!e.includes(n.role))return a.NextResponse.json({error:"Forbidden - Insufficient permissions"},{status:403})}}async function d(e){let r=await c(e);if(r instanceof a.NextResponse)return r;let t=l(["ADMIN","YETKILI"])(e);if(t instanceof a.NextResponse)return t;let{searchParams:s}=new URL(e.url),n=s.get("sheet");try{let e=await (0,u.y)();if(!e)return a.NextResponse.json({error:"Google Sheets credentials not configured"},{status:500});if(n){let r=await e.syncFromSheets(n);return a.NextResponse.json({success:!0,result:r,timestamp:new Date().toISOString()})}{let r=await e.syncAllFromSheets(),t=Object.values(r).reduce((e,r)=>({created:e.created+r.created,updated:e.updated+r.updated,deleted:e.deleted+r.deleted,errors:e.errors+r.errors.length}),{created:0,updated:0,deleted:0,errors:0});return a.NextResponse.json({success:!0,results:r,totals:t,timestamp:new Date().toISOString()})}}catch(e){return console.error("Sync error:",e),a.NextResponse.json({error:"Sync failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function x(e){let r=await c(e);if(r instanceof a.NextResponse)return r;let t=l(["ADMIN"])(e);if(t instanceof a.NextResponse)return t;try{let r;let{sheetKey:t,syncType:s}=await e.json(),n=await (0,u.y)();if(!n)return a.NextResponse.json({error:"Google Sheets credentials not configured"},{status:500});return r=t?await n.syncFromSheets(t):await n.syncAllFromSheets(),a.NextResponse.json({success:!0,result:r,timestamp:new Date().toISOString()})}catch(e){return console.error("Sync error:",e),a.NextResponse.json({error:"Sync failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/sync/route",pathname:"/api/sync",filename:"route",bundlePath:"app/api/sync/route"},resolvedPagePath:"C:\\Users\\furkan.cakir\\Desktop\\ServicePro\\ServicePro_Demo\\app\\api\\sync\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:q,serverHooks:y}=f,m="/api/sync/route";function g(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:q})}},46569:(e,r,t)=>{t.d(r,{RA:()=>i,WX:()=>a,so:()=>u});var s=t(86890),n=t(41463);let o=new TextEncoder().encode(process.env.JWT_SECRET||"fallback-secret-change-in-production");async function i(e){return await new s.N({...e}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(o)}async function a(e){try{let{payload:r}=await (0,n._)(e,o);if("userId"in r&&"email"in r&&"role"in r)return r;return null}catch(e){return console.error("Token verification failed:",e),null}}function u(e){return e?.startsWith("Bearer ")?e.substring(7):null}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,1814,7816,3705],()=>t(24829));module.exports=s})();